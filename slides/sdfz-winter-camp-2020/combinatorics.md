# 组合数学选讲

<br>

## riteme

<img alt="Creative Commons License" class="cc" src="assets/cc4-by-nc-sa.png">

***

### 鸽笼原理

**基本形式：**$n + 1$ 个球放入 $n$ 个盒子中，至少有一个盒子里面有不少于两个球。

---

**扩展形式：**令 $q_1,\ q_2,\ ...,\ q_n$ 为正整数，则 $\sum_{i = 1}^n q_i - n + 1$ 个球放入 $n$ 个盒子中，则至少有一个 $i$ 满足第 $i$ 个盒子里有 $q_i$ 个球。

---

如果没有，则第 $i$ 个盒子总共只有 $q_i - 1$ 个球，因此总球数上限为 $\sum_{i = 1}^n q_i - n$，矛盾。

---

**推论**　$n$ 个球放入 $m$ 个盒子中，则存在有一个盒子里有至少 $\lceil n / m \rceil$ 个球。

---

**问题：**如果尽可能平均分（即每个盒子要么 $\lfloor n/m \rfloor$ 个，要么 $\lceil n/m \rceil$ 个），有几个盒子会装 $\lceil n/m \rceil$ 个球？

---

**推论**　对于 $n$ 个正整数 $q_1,\ q_2,\ q_3,\ ...,\ q_n$，若它们的平均值大于某个数 $r - 1$，则必有一个 $q_i \geqslant r$。

---

否则 $\sum_{i = 1}^n q_i \leqslant n(r - 1)$，与平均值 $\frac1n \sum_{i = 1}^n q_i > r - 1$ 矛盾。

+++

**推论**　在前 $2n$ 个正整数中任取 $n + 1$ 个数，其中必有两个数互质。

---

考虑分组 $\{1,\ 2\},\ \{3,\ 4\},\ ...,\ \{2n - 1,\ 2n\}$，则 $n + 1$ 个数里面必定有两个数在同一组。

---

**推论**　在前 $2n$ 个正整数中任取 $n + 1$ 个数，则必有一个数是另外一个数的倍数。

---

将一个数 $m$ 表示成 $2^k\cdot t$ 的形式，即把 $m$ 所有 $2$ 的质因子提出来，那么 $t$ 是一个奇数。于是前 $2n$ 个数按照 $t$ 分组可以分成 $n$ 组。对于同一组中的两个数 $2^i\cdot t$ 和 $2^j\cdot t$，根据 $i$、$j$ 之间的大小关系，必有一个数是另一个数的倍数。

---

**推论**　将一大一小两个同心圆盘分为 $2n$ 段。对于大圆盘，任取 $n$ 个染黑色，其余染白色。对于小圆盘，任意黑白染色。旋转小圆盘，则必有一个旋转角度使得大小圆盘对应位置上相同的颜色段的数量不少于 $n$。

---

一共有 $2n$ 种旋转方式，设第 $i$ 种旋转方式相同的颜色段数量为 $q_i$。考虑计算 $\sum_{i = 1}^{2n} q_i$。对于小圆盘上任意一段，在其旋转一周的过程中，必有 $n$ 次颜色相同，以及 $n$ 次颜色不同，于是 $\sum_{i = 1}^{2n} q_i = 2n \cdot n = 2n^2$。因此 $q_i$ 的平均值不小于 $n$，则必有某个 $q_i \geqslant n$。

+++

**推论**　对于任意长度为 $n$ 的序列 $\{a_i\}$，必有一个区间的和内被 $n$ 整除。

---

考虑前缀和在模 $n$ 意义下的值即可。

---

**推论**　任取 $n + 2$ 个整数，则其中必有两个数，满足两数之和或者两数之差能被 $2n$ 整除。

---

首先可以假设这些数在模 $2n$ 意义下两两不同。考虑每个数以及自己的相反数，除了 $0$ 和 $n$ 这两个自己等于自己的相反数外，其余 $n$ 个数均不与自己的相反数相同。因此一共拿到 $2n + 2$ 个数，而这些数在模 $2n$ 意义下必定有两者相同，则这两者的差为 $0$，并且根据两者的符号可以知道是原来的两数之和还是原来的两数之差。

---

下面这个结论叫做 Erdős–Szekeres 定理。

**推论**　对于任意长度为 $rs + 1$ 的序列，序列中要么存在一个长度为 $r + 1$ 的单增（单调不减、上升）的子序列，要么存在一个长度为 $s + 1$ 的单减（单调不增、下降）的子序列。

---

如果没有长度为 $r + 1$ 的单增序列，则最长上升子序列长度最多为 $r$。考虑做一个从后往前的 DP，设 $f_i$ 表示以 $i$ 开始的最长上升子序列，则我们可以把原序列分为若干个极长的上升子序列，那么这些子序列的起点则构成一个下降子序列，且长度至少为 $s + 1$。

***

### The Phone Number

<https://codeforces.com/problemset/problem/1017/C>

给定 $n$，要求构造一个排列，使得排列中最长上升子序列的长度与最长下降子序列的长度之和最小。

$n \leqslant 10^5$。

+++

设定参数 $L$，构造排列为：

$$
\begin{aligned}
& n - L + 1,\ n - L + 2,\ ...,\ n, \\
& n - 2L + 1,\ n - 2L + 2,\ ...,\ n - L, \\
& ... \\
& 1,\ 2,\ ...,\ n \bmod L
\end{aligned}
$$

例如，当 $n = 22$，$L = 4$ 时：

$$
\begin{aligned}
&19,\ 20,\ 21,\ 22,\\ &15,\ 16,\ 17,\ 18,\\ &11,\ 12,\ 13,\ 14,\\ &7,\ 8,\ 9,\ 10,\\ &3,\ 4,\ 5,\ 6,\\ &1,\ 2
\end{aligned}
$$

此时最长上升子序列为 $L$，而最长下降子序列为 $\lceil n / L \rceil$。

---

枚举 $L$，使得 $L + \lceil n/L \rceil$ 最小，之后再构造即可。

***

### Dirichlet 近似定理

**定理**　设 $α$ 为实数，对于任意正整数 $n$，存在整数 $q$ 和 $[1,\ n]$ 内的正整数 $p$，满足：

$$
|pα - q| < \frac1n
$$

---

设取小数部分的记号为 $\{x\} = x - \lfloor x \rfloor$。考虑 $\{0\cdot α\},\ \{1\cdot α\},\ \{2\cdot α\},\ ...,\ \{n\cdot α\}$，这 $n + 1$ 个值，同时将区间 $[0,\ 1)$ 划分为 $n$ 个等长的子区间 $[0,\ 1/n),\ [1/n,\ 2/n),\ ...,\ [(n - 1)/n,\ 1)$，那么必定有两个下标 $0 \leqslant i < j \leqslant n$，使得 $\{iα\}$ 和 $\{jα\}$ 落在同一个子区间内，则：

$$
\begin{aligned}
1/n & > |\{jα\} - \{iα\}| \\
& = |jα - \lfloor jα \rfloor - (iα - \lfloor iα \rfloor)| \\
& = |(j - i)α - (\lfloor jα \rfloor - \lfloor iα \rfloor)|
\end{aligned}
$$

因此令 $p = j - i$，$q = \lfloor jα \rfloor - \lfloor iα \rfloor$ 即可。

---

稍微变一下形：

$$
|α - \frac{q}p| < \frac1{np} \leqslant \frac1{p^2}
$$

即有理数能在 “平方” 级别内逼近任意实数（无理数）。寻找最优逼近使用的是 Stern-Brocot 树。

***

### 排列数

$n$ 个不同的球的排列总数为 $n!$，其中任选 $m$ 个球后组成的排列个数为 $P(n,\ m) = n!/(n - m)!$。

---

**问题**　有 $n$ 种球，第 $i$ 种球有 $a_i$ 个，则这些球的总排列个数有多少个？

---

令 $m = \sum_{i = 1}^n a_i$，则为 $m! / \prod_{i = 1}^n a_i!$ 种。可以视为把同种球之间的排列全部去掉了。

---

**问题**　把 $n$ 个球排成一个环，问有多少种不同的的排列。（不考虑对称同构）

---

任意一个环形排列通过旋转总能把 $1$ 放到最上面，这样固定 $1$ 的位置，其余元素就是普通的排列了，因此方案数为 $(n - 1)!$。

---

一般的，如果是取出 $m$ 个做排列，则为 $P(n,\ m) / m$。

---

对于多重排列的环排列个数就比较麻烦了，因为一个多重排列旋转 $n$ 次中不一定每个排列都是不同的，这涉及到一个旋转同构的问题，需要使用 Pölya 计数法。

***

### 组合数

组合数 ${n \choose m}$ 是在一个大小为 $n$ 的有限集中选出 $m$ 个元素的的方案数，即大小为 $m$ 的子集数量。易知 ${n \choose m} = P(n,\ m) / m!$，即不考虑排列的内部顺序，就是组合。因此：

$$
{n \choose m} = {n! \over m!(n - m)!}
$$

---

由分母的对称性，易知 ${n \choose m} = {n \choose n - m}$。

---

计算组合数是 OI 中的基本技能。最简单的是使用 Pascal 公式（其实就是个 DP 方程）：

$$
{n \choose m} = {n - 1 \choose m} + {n - 1 \choose m - 1}
$$

考虑第 $n$ 个元素选或不选。

---

可以用一个二维数组把所有答案存下来。这种方法适用于 $n$ 比较小的情况。

+++

如果是计算组合数对质数取模的结果，可以考虑计算阶乘以及阶乘的逆元，从而按照定义计算。

$$
\begin{array}{ll}
1& f[i]\colon i! \text{ 的值} \\
2& f^{-1}[i]\colon i! \text{ 在模意义下的乘法逆元} \\
3& M\colon \text{模数} \\
4& \\
5& f[0] := 1 \\
6& \textbf{for }i := 1..n\colon \\
7& \quad f[i] := f[i - 1] \cdot i \bmod M \\
8& f^{-1}[n] := f[i] \text{ 的乘法逆元} \\
9& \textbf{for }i := (n - 1)..0\colon \\
10& \quad f^{-1}[i] := f^{-1}[i + 1] \cdot (i + 1) \bmod M
\end{array}
$$

---

一般用于 $n$ 在 $10^5$ 至 $10^6$ 的时候。如果模数不是质数时限制比较大。

+++

有时候需要组合数的连续的项，例如计算 $\sum_{k = 1}^r {n \choose k}$。考虑相邻几个组合数之间的关系：

$$
\begin{aligned}
{n \choose m} &= {n! \over m! (n - m)!} \\
{n \choose m + 1} &= {n! \over (m + 1)! (n - m - 1)!} \\
{n + 1 \choose m} &= {(n + 1)! \over m! (n + 1 - m)!} \\
{n + 1 \choose m + 1} &= {(n + 1)! \over (m + 1)! (n - m)!}
\end{aligned}
$$

---

于是可以得到：

$$
\begin{aligned}
{n \choose m + 1} &= {n - m \over m + 1}{n \choose m} \\
{n + 1 \choose m} &= {n + 1 \over n - m + 1}{n \choose m} \\
{n + 1 \choose m + 1} &= {n + 1 \over m + 1}{n \choose m}
\end{aligned}
$$

其它的方向也是一样的推法。

---

如果能求出乘法逆元，只要知道一个组合数，就可以依次推出其周围的组合数。通常情况下 ${n \choose 0}$ 和 ${n \choose n}$ 之类的值都是显然的。适用于 $n$ 非常大（例如 $10^9$），但只需要知道部分组合数的值时使用。

***



***

二项式定理、组合恒等式、Lucas 公式